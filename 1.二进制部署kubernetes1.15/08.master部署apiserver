主机IP 10.204.243.132
1.apiserver
cat /app/kubernetes/config/apiserver
SSL="--token-auth-file=/app/kubernetes/ssl/token.csv --tls-cert-file=/app/kubernetes/ssl/kubernetes.pem  --tls-private-key-file=/app/kubernetes/ssl/kubernetes-key.pem --client-ca-file=/app/kubernetes/ssl/ca.pem --service-account-key-file=/app/kubernetes/ssl/ca-key.pem --etcd-cafile=/app/kubernetes/ssl/ca.pem --etcd-certfile=/app/kubernetes/ssl/kubernetes.pem --etcd-keyfile=/app/kubernetes/ssl/kubernetes-key.pem --proxy-client-cert-file=/app/kubernetes/ssl/proxy-client.pem --proxy-client-key-file=/app/kubernetes/ssl/proxy-client-key.pem --kubelet-certificate-authority=/app/kubernetes/ssl/ca.pem --kubelet-client-certificate=/app/kubernetes/ssl/kubernetes.pem --kubelet-client-key=/app/kubernetes/ssl/kubernetes-key.pem"
KUBE="--kubelet-timeout=60s --kubelet-port=10250"
LOGS="--logtostderr=false --log-dir=/app/kubernetes/logs --v=2 --event-ttl=1h"
ETCDMEMBER="--etcd-servers=https://10.204.243.132:2379,https://10.204.243.133:2379,https://10.204.243.134:2379"
COMMON="--apiserver-count=2  --service-node-port-range=30000-50000 --enable-bootstrap-token-auth --authorization-mode=RBAC,Node --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction --allow-privileged=true --default-not-ready-toleration-seconds=180 --default-unreachable-toleration-seconds=180 --runtime-config=api/all=true --anonymous-auth=false --enable-aggregator-routing=true"
IP="--bind-address=0.0.0.0 --secure-port=6443 --insecure-port=8080 --advertise-address=0.0.0.0 --insecure-bind-address=0.0.0.0 --service-cluster-ip-range=172.40.0.0/16"
CONFIGHPA="--requestheader-allowed-names=aggregator  --requestheader-client-ca-file=/app/kubernetes/ssl/ca.pem  --requestheader-extra-headers-prefix="X-Remote-Extra-" --requestheader-group-headers=X-Remote-Group  --requestheader-username-headers=X-Remote-User"

cat /usr/lib/systemd/system/kube-apiserver.service 
[Unit]
Description=Kubernetes API Server
Documentation=https://github.com/kubernetes/kubernetes
[Service]
EnvironmentFile=-/app/kubernetes/config/apiserver
ExecStart=/app/kubernetes/bin/kube-apiserver $KUBE $SSL $IP $ETCDMEMBER $LOGS $COMMON $CONFIGHPA
Restart=on-failure
[Install]
WantedBy=multi-user.target


2.systemctl daemon-reload && systemctl  start kube-apiserver && systemctl  enable kube-apiserver 

3.创建集群用户
绑定一个cluster-admin的权限。
kubectl create clusterrolebinding kubernetes   --clusterrole=cluster-admin   --user=kubernetes

